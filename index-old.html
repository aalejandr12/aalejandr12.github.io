<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>PurrCrafter - Tu herramienta amigable para manipular PDFs</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&amp;display=swap" rel="stylesheet"/>
    <style type="text/tailwindcss">
        :root {
            --bg-color: #FFFFFF;
            --text-color: #1F2937;
            --primary-color: #2563EB;
            --secondary-color: #F9FAFB;
            --accent-color: #3B82F6;
            --border-color: #E5E7EB;
            --text-muted-color: #6B7280;
        }
        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
        }
        .purr-card {
            transition: all 0.3s ease-in-out;
            background-color: var(--secondary-color);
            border: 1px solid var(--border-color);
        }
        .purr-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
            border-color: var(--primary-color);
        }
        .purr-button {
            transition: all 0.3s ease-in-out;
            background-color: var(--primary-color);
        }
        .purr-button:hover {
            transform: scale(1.05);
            background-color: var(--accent-color);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.2);
        }
        .filter-button {
            transition: all 0.3s ease-in-out;
            color: var(--text-muted-color);
        }
        .filter-button.active {
            background-color: var(--primary-color);
            color: white;
            font-weight: 500;
        }
        .status-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            padding: 10px;
            text-align: center;
            font-weight: bold;
            z-index: 1000;
            transition: all 0.3s ease;
        }
        .status-success { background: #10B981; color: white; }
        .status-error { background: #EF4444; color: white; }
        .status-info { background: #3B82F6; color: white; }
        .hidden { display: none; }
    </style>
</head>
<body class="min-h-screen">
    <!-- Status Bar -->
    <div id="statusBar" class="status-bar hidden"></div>

    <!-- Header Mejorado -->
    <header class="bg-white border-b border-gray-200 sticky top-0 z-40 backdrop-blur-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-3">
                    <div class="text-2xl">üê±</div>
                    <h1 class="text-xl font-bold text-gray-900">PurrCrafter</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <div id="connectionStatus" class="text-sm">
                        <span class="text-gray-500">Conectando...</span>
                    </div>
                    <button id="themeToggle" class="p-2 rounded-lg hover:bg-gray-100 transition-colors">
                        <span class="text-xl">üåô</span>
                    </button>
                    <a href="/docs" target="_blank" class="text-blue-600 hover:text-blue-800 font-medium">API Docs</a>
                </div>
            </div>
        </div>
    </header>

    <!-- Contenido Principal -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Hero Section -->
        <section class="text-center mb-12 bg-gradient-to-r from-blue-50 to-indigo-100 rounded-2xl p-8">
            <h2 class="text-4xl font-bold text-gray-900 mb-4">
                Organiza tus PDFs como un <span class="text-blue-600">profesional</span>
            </h2>
            <p class="text-xl text-gray-600 mb-8 max-w-2xl mx-auto">
                Herramienta inteligente para organizar y unir documentos PDF por nombre de archivo o contenido
            </p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <button onclick="scrollToUpload()" class="purr-button text-white px-8 py-3 rounded-lg font-medium">
                    Empezar Ahora
                </button>
                <a href="#como-funciona" class="border border-gray-300 text-gray-700 px-8 py-3 rounded-lg font-medium hover:bg-gray-50 transition-colors">
                    C√≥mo Funciona
                </a>
            </div>
        </section>

        <!-- Workspace Info -->
        <section id="workspace-info" class="mb-8 hidden">
            <div class="bg-green-50 border border-green-200 rounded-xl p-4">
                <div class="flex items-center">
                    <div class="text-green-500 text-xl mr-3">‚úÖ</div>
                    <div>
                        <h3 class="font-semibold text-green-800">Workspace Activo</h3>
                        <p class="text-green-600 text-sm">ID: <span id="workspaceId" class="font-mono"></span></p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Filtros de Organizaci√≥n -->
        <section id="upload-section" class="mb-8">
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <h3 class="text-2xl font-bold text-gray-900 mb-6 text-center">Selecciona tu m√©todo de organizaci√≥n</h3>
                
                <div class="flex flex-wrap gap-4 justify-center mb-6">
                    <button onclick="setOrderType('filename')" class="filter-button bg-blue-600 text-white px-6 py-3 rounded-lg font-medium active">
                        üìù Por Nombre de Archivo
                    </button>
                    <button onclick="setOrderType('content')" class="filter-button bg-gray-200 text-gray-700 px-6 py-3 rounded-lg font-medium">
                        üìÑ Por Contenido
                    </button>
                    <button onclick="setOrderType('hybrid')" class="filter-button bg-gray-200 text-gray-700 px-6 py-3 rounded-lg font-medium">
                        üîÄ H√≠brido (Nombre + Contenido)
                    </button>
                </div>

                <!-- Descripci√≥n del m√©todo seleccionado -->
                <div id="method-description" class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                    <h4 class="font-semibold text-blue-900 mb-2">üìù Organizaci√≥n por Nombre de Archivo</h4>
                    <p class="text-blue-800">Organiza los PDFs bas√°ndose en c√≥digos o patrones encontrados en el nombre del archivo.</p>
                </div>

                <!-- Upload Area -->
                <div id="dropZone" class="border-2 border-dashed border-gray-300 rounded-xl p-8 text-center hover:border-blue-400 transition-colors bg-gray-50">
                    <div class="text-6xl mb-4">üìé</div>
                    <h4 class="text-xl font-semibold text-gray-900 mb-2">Arrastra y suelta tus PDFs aqu√≠</h4>
                    <p class="text-gray-600 mb-4">o haz clic para seleccionar archivos</p>
                    <input type="file" id="fileInput" multiple accept=".pdf" class="hidden">
                    <button onclick="document.getElementById('fileInput').click()" class="purr-button text-white px-6 py-3 rounded-lg font-medium">
                        Seleccionar Archivos
                    </button>
                </div>

                <!-- Files List -->
                <div id="filesList" class="mt-6 hidden">
                    <h4 class="font-semibold text-gray-900 mb-3">Archivos seleccionados:</h4>
                    <div id="filesContainer" class="space-y-2"></div>
                    <button id="processBtn" onclick="processFiles()" class="mt-4 purr-button text-white px-6 py-3 rounded-lg font-medium w-full">
                        Procesar y Organizar PDFs
                    </button>
                </div>
            </div>
        </section>

        <!-- Resultados -->
        <section id="results" class="hidden">
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <h3 class="text-2xl font-bold text-gray-900 mb-6">Resultados</h3>
                <div id="resultsContent"></div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-50 border-t border-gray-200 mt-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="text-center text-gray-600">
                <p>&copy; 2025 PurrCrafter. Hecho con ‚ù§Ô∏è para organizar tus documentos.</p>
            </div>
        </div>
    </footer>

    <script>
        // API Configuration
        const API_BASE_URL = 'https://api-oculto-9k7s.aaleddy.app';
        let currentOrderType = 'filename';
        let currentWorkspaceId = null;
        let callbackCounter = 0;
        let uploadedFiles = [];

        // Helper function para JSONP (reemplaza fetch)
        function jsonpRequest(url, params = {}) {
            return new Promise((resolve, reject) => {
                callbackCounter++;
                const callbackName = `jsonpCallback${callbackCounter}`;
                
                window[callbackName] = function(data) {
                    delete window[callbackName];
                    document.head.removeChild(script);
                    resolve(data);
                };
                
                params.callback = callbackName;
                
                const queryString = Object.keys(params)
                    .map(key => `${encodeURIComponent(key)}=${encodeURIComponent(params[key])}`)
                    .join('&');
                
                const fullUrl = `${url}?${queryString}`;
                const script = document.createElement('script');
                script.src = fullUrl;
                
                script.onerror = function() {
                    delete window[callbackName];
                    document.head.removeChild(script);
                    reject(new Error('Error de conexi√≥n con el servidor'));
                };
                
                setTimeout(() => {
                    if (window[callbackName]) {
                        delete window[callbackName];
                        document.head.removeChild(script);
                        reject(new Error('Tiempo de espera agotado'));
                    }
                }, 15000);
                
                document.head.appendChild(script);
            });
        }

        // Status functions
        function showStatus(message, type = 'info', duration = 3000) {
            const statusBar = document.getElementById('statusBar');
            statusBar.textContent = message;
            statusBar.className = `status-bar status-${type}`;
            statusBar.classList.remove('hidden');
            
            if (duration > 0) {
                setTimeout(() => {
                    statusBar.classList.add('hidden');
                }, duration);
            }
        }

        function updateConnectionStatus(status) {
            const statusEl = document.getElementById('connectionStatus');
            if (status === 'connected') {
                statusEl.innerHTML = '<span class="text-green-600">‚úÖ Conectado</span>';
            } else if (status === 'error') {
                statusEl.innerHTML = '<span class="text-red-600">‚ùå Error</span>';
            } else {
                statusEl.innerHTML = '<span class="text-yellow-600">‚è≥ Conectando...</span>';
            }
        }

        // Initialize workspace
        async function initializeWorkspace() {
            try {
                updateConnectionStatus('connecting');
                
                const data = await jsonpRequest(`${API_BASE_URL}/jsonp/workspaces`);
                
                if (data.success && data.workspace_id) {
                    currentWorkspaceId = data.workspace_id;
                    document.getElementById('workspaceId').textContent = currentWorkspaceId;
                    document.getElementById('workspace-info').classList.remove('hidden');
                    
                    updateConnectionStatus('connected');
                    console.log('Workspace creado:', currentWorkspaceId);
                } else {
                    throw new Error('No se pudo crear el workspace');
                }
                
            } catch (error) {
                console.error('Error creando workspace:', error);
                updateConnectionStatus('error');
                showStatus('‚ùå Error al conectar con el servidor', 'error', 5000);
            }
        }

        // Set order type
        function setOrderType(type) {
            currentOrderType = type;
            
            // Update buttons
            document.querySelectorAll('.filter-button').forEach(btn => {
                btn.classList.remove('active', 'bg-blue-600', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            event.target.classList.add('active', 'bg-blue-600', 'text-white');
            event.target.classList.remove('bg-gray-200', 'text-gray-700');
            
            // Update description
            updateMethodDescription(type);
        }

        function updateMethodDescription(type) {
            const descriptions = {
                filename: {
                    icon: 'üìù',
                    title: 'Organizaci√≥n por Nombre de Archivo',
                    description: 'Organiza los PDFs bas√°ndose en c√≥digos o patrones encontrados en el nombre del archivo.'
                },
                content: {
                    icon: 'üìÑ',
                    title: 'Organizaci√≥n por Contenido',
                    description: 'Analiza el contenido interno de los PDFs para encontrar c√≥digos y organizarlos.'
                },
                hybrid: {
                    icon: 'üîÄ',
                    title: 'Organizaci√≥n H√≠brida',
                    description: 'Combina an√°lisis de nombre de archivo y contenido para la mejor organizaci√≥n posible.'
                }
            };
            
            const desc = descriptions[type];
            document.getElementById('method-description').innerHTML = `
                <h4 class="font-semibold text-blue-900 mb-2">${desc.icon} ${desc.title}</h4>
                <p class="text-blue-800">${desc.description}</p>
            `;
        }

        // File handling
        function scrollToUpload() {
            document.getElementById('upload-section').scrollIntoView({ behavior: 'smooth' });
        }

        // File input handling
        document.getElementById('fileInput').addEventListener('change', handleFileSelect);

        function handleFileSelect(event) {
            const files = Array.from(event.target.files);
            if (files.length > 0) {
                displaySelectedFiles(files);
            }
        }

        function displaySelectedFiles(files) {
            const filesList = document.getElementById('filesList');
            const filesContainer = document.getElementById('filesContainer');
            
            filesContainer.innerHTML = '';
            uploadedFiles = files;
            
            files.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'flex items-center justify-between bg-gray-50 p-3 rounded-lg';
                fileItem.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <span class="text-red-500 text-xl">üìÑ</span>
                        <span class="font-medium">${file.name}</span>
                        <span class="text-gray-500 text-sm">(${(file.size / 1024 / 1024).toFixed(2)} MB)</span>
                    </div>
                    <button onclick="removeFile(${index})" class="text-red-500 hover:text-red-700">
                        <span class="text-xl">üóëÔ∏è</span>
                    </button>
                `;
                filesContainer.appendChild(fileItem);
            });
            
            filesList.classList.remove('hidden');
        }

        function removeFile(index) {
            uploadedFiles.splice(index, 1);
            displaySelectedFiles(uploadedFiles);
        }

        // Process files
        async function processFiles() {
            if (!currentWorkspaceId) {
                showStatus('‚ùå No hay workspace activo. Recarga la p√°gina.', 'error');
                return;
            }
            
            if (uploadedFiles.length === 0) {
                showStatus('‚ùå No hay archivos seleccionados', 'error');
                return;
            }

            const processBtn = document.getElementById('processBtn');
            processBtn.disabled = true;
            processBtn.textContent = 'Procesando...';

            try {
                // Simular procesamiento
                showStatus('üîÑ Organizando PDFs...', 'info', 0);
                
                const endpoint = currentOrderType === 'filename' ? 'order-by-filename' :
                               currentOrderType === 'content' ? 'order-by-content' : 'order-hybrid';

                const result = await jsonpRequest(`${API_BASE_URL}/jsonp/workspaces/${currentWorkspaceId}/${endpoint}`);
                
                if (result.success) {
                    showResults(result);
                    showStatus('‚úÖ PDFs organizados exitosamente', 'success');
                } else {
                    throw new Error(result.error || 'Error desconocido');
                }

            } catch (error) {
                console.error('Error:', error);
                showStatus(`‚ùå Error: ${error.message}`, 'error', 5000);
                showErrorResults(error.message);
            } finally {
                processBtn.disabled = false;
                processBtn.textContent = 'Procesar y Organizar PDFs';
            }
        }

        function showResults(data) {
            const resultsSection = document.getElementById('results');
            const resultsContent = document.getElementById('resultsContent');
            
            if (data.success && data.data && data.data.pdf_url) {
                resultsContent.innerHTML = `
                    <div class="text-center py-8">
                        <div class="text-6xl mb-4">‚úÖ</div>
                        <h4 class="text-2xl font-bold text-green-600 mb-4">¬°PDFs organizados exitosamente!</h4>
                        <p class="text-gray-600 mb-6">Tu archivo organizado est√° listo para descargar</p>
                        <div class="space-y-4">
                            <a href="${API_BASE_URL}${data.data.pdf_url}" target="_blank" 
                               class="inline-block purr-button text-white px-8 py-3 rounded-lg font-medium">
                                üì• Descargar PDF Organizado
                            </a>
                            <div class="mt-4">
                                <button onclick="resetForm()" class="border border-gray-300 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-50">
                                    Organizar m√°s PDFs
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                showErrorResults('Respuesta inesperada del servidor');
            }
            
            resultsSection.classList.remove('hidden');
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }

        function showErrorResults(errorMessage) {
            const resultsSection = document.getElementById('results');
            const resultsContent = document.getElementById('resultsContent');
            
            resultsContent.innerHTML = `
                <div class="text-center py-8">
                    <div class="text-4xl mb-4">‚ùå</div>
                    <h4 class="text-xl font-bold text-red-600 mb-4">Error al procesar</h4>
                    <p class="text-gray-600 mb-4">${errorMessage}</p>
                    <button onclick="resetForm()" class="border border-gray-300 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-50">
                        Intentar de nuevo
                    </button>
                </div>
            `;
            
            resultsSection.classList.remove('hidden');
        }

        function resetForm() {
            document.getElementById('fileInput').value = '';
            document.getElementById('filesList').classList.add('hidden');
            document.getElementById('results').classList.add('hidden');
            uploadedFiles = [];
        }

        // Theme toggle
        document.getElementById('themeToggle').addEventListener('click', () => {
            document.body.classList.toggle('dark');
        });

        // Drag and drop
        const dropZone = document.getElementById('dropZone');
        
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('border-blue-400', 'bg-blue-50');
        });
        
        dropZone.addEventListener('dragleave', (e) => {
            e.preventDefault();
            dropZone.classList.remove('border-blue-400', 'bg-blue-50');
        });
        
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('border-blue-400', 'bg-blue-50');
            
            const files = Array.from(e.dataTransfer.files).filter(file => file.type === 'application/pdf');
            if (files.length > 0) {
                displaySelectedFiles(files);
            }
        });

        // Initialize on load
        window.addEventListener('load', () => {
            console.log('üöÄ Inicializando PurrCrafter...');
            setTimeout(initializeWorkspace, 1000);
        });
    </script>
</body>
</html>
        }
        .filter-button:hover:not(.active) {
            background-color: #E5E7EB;
            color: var(--text-color);
        }
    </style>
</head>
<body class="antialiased">
    <div class="container mx-auto px-4 min-h-screen flex flex-col items-center pt-10">
        <header class="text-center w-full max-w-4xl mb-8">
            <h1 class="text-5xl font-bold text-[var(--text-color)] drop-shadow-sm">PurrCrafter</h1>
            <p class="text-lg text-[var(--text-muted-color)] mt-2">Tu herramienta amigable para manipular tus archivos</p>
        </header>
        
        <div class="w-full max-w-4xl mb-12 flex justify-center">
            <div class="bg-[var(--secondary-color)]/80 backdrop-blur-sm p-2 rounded-full shadow-sm border border-[var(--border-color)] flex space-x-2">
                <button class="filter-button active px-6 py-2 rounded-full text-md">Todos</button>
                <button class="filter-button px-6 py-2 rounded-full text-md">PDF</button>
                <button class="filter-button px-6 py-2 rounded-full text-md">Videos</button>
            </div>
        </div>
        
        <main class="w-full max-w-4xl flex-grow">
            <div class="grid md:grid-cols-2 gap-8 lg:gap-12">
                <div class="p-8 rounded-2xl shadow-md flex flex-col items-center justify-center text-center purr-card">
                    <div class="mb-6">
                        <svg class="w-20 h-20 text-[var(--primary-color)]" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
                        </svg>
                    </div>
                    <h2 class="text-2xl font-semibold text-[var(--text-color)] mb-3">Unir por Nombre</h2>
                    <p class="text-[var(--text-muted-color)] mb-8">Organiza y combina tus PDFs seg√∫n su nombre de archivo.</p>
                    <button onclick="window.location.href='subir-nombre.html'" class="w-full max-w-xs px-6 py-3 text-lg font-semibold text-white rounded-xl shadow-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-100 focus:ring-[var(--accent-color)] purr-button">
                        Seleccionar PDF
                    </button>
                </div>
                
                <div class="p-8 rounded-2xl shadow-md flex flex-col items-center justify-center text-center purr-card">
                    <div class="mb-6">
                        <svg class="w-20 h-20 text-[var(--primary-color)]" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M4 6h16M4 12h16m-7 6h7" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
                            <path d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16l3.5-2 3.5 2 3.5-2 3.5 2z" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
                        </svg>
                    </div>
                    <h2 class="text-2xl font-semibold text-[var(--text-color)] mb-3">Unir por Contenido</h2>
                    <p class="text-[var(--text-muted-color)] mb-8">Fusiona tus PDFs bas√°ndose en el contenido de los documentos.</p>
                    <button onclick="window.location.href='subir-contenido.html'" class="w-full max-w-xs px-6 py-3 text-lg font-semibold text-white rounded-xl shadow-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-100 focus:ring-[var(--accent-color)] purr-button">
                        Seleccionar PDF
                    </button>
                </div>
            </div>
        </main>
        
        <footer class="w-full max-w-4xl py-8 mt-12 text-center text-sm text-[var(--text-muted-color)]">
            <div class="flex justify-center space-x-6 mb-4">
                <a class="hover:text-[var(--accent-color)] transition-colors" href="terminos.html">T√©rminos y Condiciones</a>
                <a class="hover:text-[var(--accent-color)] transition-colors" href="privacidad.html">Privacidad</a>
                <a class="hover:text-[var(--accent-color)] transition-colors" href="mailto:contacto@purrcrafter.com">Contacto</a>
            </div>
            <p>¬© 2024 PurrCrafter. Todos los derechos reservados.</p>
        </footer>
    </div>
</body>
</html>